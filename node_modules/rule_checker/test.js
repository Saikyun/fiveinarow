'use strict';

var isSet = require('sai_generic').isSet;

function test(rules, obj, data, error) {
	error = error || function(message) {
		console.warn(message);
	};

	if (isSet(rules)) {
		var passed = rules.filter(function(ruleTest) {
			if (typeof ruleTest === 'function') {
				return ruleTest(obj, error);
			} else if (ruleTest.hasOwnProperty('params') && ruleTest.hasOwnProperty('test')) {
				if (!isSet(data.get(ruleTest.params))) {
					error('data.' + ruleTest.params + ' is not set');
					return 'bajs';
				}
				
				return ruleTest.test(obj, data.get(ruleTest.params), error);
			} else {
				error('something is very wrong with ruleTest ' + ruleTest);
				return 'bajs';
			}
		});
		
		return passed.length === rules.length;
	}
	
	console.log('no rules given');
	
	return true;
}

module.exports = test;